---
title: ç”¨Unityè¿˜åŸæ˜Ÿéœ²è°·ç‰©è¯­ï¼ˆ2ï¼‰ï¼šç§åœ°ç¯‡ï¼ˆæ•°æ®è¯»å†™+TileMapï¼‰
date: 2021-06-26 17:52:13
tags: 
- Unity
- TileMap
- litjson
categories:
- Unity 
keyword: 'Stardew Valley'
description: Unityå¤åˆ»æ˜Ÿéœ²è°·æ•°æ®ç¯‡
cover : https://z3.ax1x.com/2021/06/26/RGEHkq.gif
---
å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯æƒ³å¯¹ğŸğŸ‡ä½¿ç”¨ç‚æ‹³çš„ç‚æ‹³ï¼Œä¸Šä¸€ç¯‡æ˜Ÿéœ²è°·ä¸­æˆ‘å®Œæˆäº†äººç‰©çš„ç§»åŠ¨å¹¶æ­å»ºäº†ä¸€ä¸ªç®€å•çš„ç•Œé¢ï¼Œè¿™ç¯‡å°±æ¥ç…ç…æ˜Ÿéœ²è°·çš„åœ°æ˜¯æ€ä¹ˆç§çš„ã€‚

é¦–å…ˆçœ‹çœ‹æ¸¸æˆä¸­çš„ç§åœ°çš„è¿‡ç¨‹ï¼š

![](1g.gif)

å¤§è‡´ä¸Šå®Œæˆä¸€æ¬¡è€•ç§ï¼Œéœ€è¦è¿™å‡ ä¸ªæ­¥éª¤ï¼šé€‰ä¸­é”„å¤´â€”å¼€å¦ä¸€å—åœ°â€”é€‰æ‹©ç§å­ç§ä¸‹â€”æµ‡æ°´ï¼›åŒæ—¶ç§å­ä¼šéšæ—¶é—´çš„æµé€æˆé•¿ï¼Œé•¿åˆ°æœ‰å¶ç‰‡åäººç‰©èµ°è¿‡ï¼Œä¼šè§¦å‘ä¸€ä¸ªåº„ç¨¼åŠ¨ä¸€ä¸‹çš„åŠ¨ç”»ã€‚

æ‰€ä»¥è¿™é‡Œæˆ‘è¦åšçš„åŠŸèƒ½å°±æ¸…æ™°äº†ï¼Œå…ˆæ•´ä¸ªåº„ç¨¼çš„é¢„åˆ¶ä½“ï¼Œå…¶ä¸­åŒ…å«æ‰€éœ€çš„å›¾ç‰‡æ–‡å­—ç´ æï¼Œç„¶åç‚¹å‡»ä¸€ä¸‹åœŸåœ°å°±åœ¨é‚£ä½ç½®ç”Ÿæˆä¸€ä¸ªï¼Œå¤§åŠŸå‘Šæˆå•¦ï¼

æ‰æ€ª~

![](2.jpeg)

è€ƒè™‘åˆ°æ˜Ÿéœ²è°·çš„ç‰©å“ç¹å¤šï¼Œå¦‚æœç”¨é¢„åˆ¶ä½“æ¥åˆ¶ä½œæ¯ä¸ªå•ç‹¬çš„ç‰©å“ï¼Œå°±å¤ªç¬¨æ‹™äº†ï¼›åŒæ—¶æ¯ä¸ªç‰©å“æœ‰è‡ªå·±çš„æè¿°å’Œå„ç§å±æ€§ï¼Œå¯¹åº”çš„Spritesä¹Ÿå¯ä»¥é€šè¿‡å…¶åœ°å€å®æ—¶è¯»å–ï¼Œæ‰€ä»¥æˆ‘å¸Œæœ›èƒ½é€šè¿‡è¡¨æ ¼æ¥å¡«å†™è¿™äº›ç‰©å“çš„å›ºæœ‰å±æ€§ï¼Œè¿™äº›æ•°æ®å±äºé™æ€æ•°æ®ã€‚

åŒæ—¶ç§å­ï¼Œé±¼ï¼Œè¿™äº›ç‰©å“ä½¿ç”¨æ—¶ä¼šæœ‰æ•°é‡çš„å¢å‡ï¼Œè€Œæ–§å¤´ï¼Œé”„å¤´è¿™äº›é“å…·åˆ™å¯ä»¥è¿›è¡Œå‡çº§ï¼Œæ•°é‡ï¼Œç­‰çº§è¿™äº›æ•°æ®å±äºåŠ¨æ€æ•°æ®ï¼Œç»å¸¸æ”¹å˜ï¼Œæ¸¸æˆç»“æŸä¹Ÿéœ€è¦ä¿å­˜ä¸‹æ¥ã€‚

æ‰€ä»¥æœ€åæˆ‘çš„æ–¹æ¡ˆæ˜¯ï¼šç‰©å“çš„åå­—ï¼Œæè¿°ï¼ŒSpritesåœ°å€ç­‰é™æ€æ•°æ®é€šè¿‡è¡¨æ ¼è·å¾—ï¼Œè¡¨æ ¼çš„è¯»å–ä½¿ç”¨EPPlusæ’ä»¶å®ç°ï¼›ç‰©å“çš„æ•°é‡ï¼Œç­‰çº§ç­‰åŠ¨æ€æ•°æ®ï¼Œä»¥jsonæ–‡ä»¶çš„æ–¹å¼ä¿å­˜ï¼Œè¿™é‡Œæˆ‘ä½¿ç”¨äº†LitJsonæ¥å®ç°ã€‚

é¦–å…ˆå†™ä¸ªç‰©å“çš„åŸºç¡€ç±»ï¼Œå†åœ¨è¡¨æ ¼ä¸­å¡«ä¸Šå¯¹åº”çš„é™æ€æ•°æ®ï¼š

```csharp
public class ItemInfo
{
    //åŠ¨æ€æ•°æ®,ä»jsonä¸­è·å–
    public int Id;
    public int amount;
    public ItemQuality itemQuality;
    public bool isSelected;

    //é™æ€æ•°æ®
    public string name;
    public string description;
    public string []icons;//è¡¨æ ¼ä¸­å›¾ç‰‡åå­—çš„é›†åˆ
    public ItemType itemType;
    public Tool tool;
    public int growTime;

    /// æ„é€ å‡½æ•°ä»…æ„é€ é™æ€æ•°æ®ï¼Œé€šè¿‡è¡¨æ ¼idè·å–
    public ItemInfo(int BaseDataid )
    {
        this.name = GetBaseData.instance.baseInfo[BaseDataid].name ;
        this.description = GetBaseData.instance.baseInfo[BaseDataid].description;
        this.icons = GetBaseData.instance.baseInfo[BaseDataid].icons;
        this.itemType = GetBaseData.instance.baseInfo[BaseDataid].itemType;
        this.tool = GetBaseData.instance.baseInfo[BaseDataid].tool;
        this.growTime = GetBaseData.instance.baseInfo[BaseDataid].growTime ;
    }
}
```
![](3.png)

è¡¨æ ¼çš„è¯»å–æˆ‘ä½¿ç”¨EPPlusæ’ä»¶ï¼Œä½¿ç”¨æ–¹æ³•å¾ˆç®€å•ï¼Œç½‘ä¸Šæ‰¾åˆ°å¯¹åº”dllæ–‡ä»¶åˆ°å·¥ç¨‹ï¼Œè°ƒç”¨è¿™ä¸¤ä¸ªæŒ‡ä»¤é›†ï¼š

```csharp 
using OfficeOpenXml;
using System.IO;
```
é™æ€æ•°æ®è¯»å–ï¼š

```csharp
    public void GetExcelData()
    {
        string FilePath = Application.dataPath + "/Resources/ItemData/BaseData.xlsx";
        Debug.Log("è·¯å¾„" + FilePath);
        FileInfo fileInfo = new FileInfo(FilePath);
        if (fileInfo.Length == 0)
        {
            Debug.Log("Excelæ–‡ä»¶ä¸å­˜åœ¨");
            return;
        }

        using (ExcelPackage excel = new ExcelPackage(fileInfo))
        {
            ExcelWorksheet worksheet = excel.Workbook.Worksheets[1];

            int maxRow_Data = worksheet.Dimension.End.Row; //è¡Œ
            int maxColumn_Data = worksheet.Dimension.End.Column; //åˆ—
            int Id = 0;

            //ä»ç¬¬äºŒè¡Œå¼€å§‹è¯»å–æ•°æ®
            for (int i = 2; i <= maxRow_Data; i++)
            {
                BaseMessage info  = new BaseMessage();
                string name=null;
                for (int j = 1; j <= maxColumn_Data; j++)
                {
                    switch (j)
                    {
                        case 1:
                            info.name = worksheet.Cells[i, j].Value.ToString();
                            Debug.Log("åå­—" + name);
                            break;
                        case 2:
                            info.description = worksheet.Cells[i, j].Value.ToString();
                            break;
                        case 3:
                            string temp = worksheet.Cells[i, j].Value.ToString();
                            info.icons = temp.Split('ï¼Œ');
                            break;
                        case 4:
                            string temp2 = worksheet.Cells[i, j].Value.ToString();
                            info.itemType = (ItemType)int.Parse(temp2);
                            break;
                        case 5:
                            string temp5 = worksheet.Cells[i, j].Value.ToString();
                            info.tool = (Tool)int.Parse(temp5);
                            break;
                        case 6:
                            string temp6 = worksheet.Cells[i, j].Value.ToString();
                            info.growTime= int.Parse(temp6);
                            break;
                        default:
                            break;
                    }
                }
                baseInfo.Add(Id , info);
                Id++;
            }
        }//å…³é—­è¡¨æ ¼
    }
```
ç‰©å“çš„Spriteå•ç‹¬å†™äº†ä¸ªæ–¹æ³•ï¼Œæ–¹ä¾¿ç›´æ¥é€šè¿‡åå­—è¯»å–ï¼š

```csharp

    public string SpritesPath = "Sprites";
    private Sprite[] sprites;
    private Dictionary<string, object> spritesDictionary = new Dictionary<string, object>();
    // åŠ è½½æ‰€æœ‰ç²¾çµå›¾
    public void LoadAllSprites()
    {
        sprites = Resources.LoadAll<Sprite>(SpritesPath);
        if (sprites.Length == 0)
        {
            Debug.Log("ç²¾çµå›¾æ²¡è¯»åˆ°");
        }
        for (int i = 0; i < sprites.Length; i++)
        {
            spritesDictionary.Add(sprites[i].name, sprites[i]);
        }
    }

    // ç›´æ¥é€šè¿‡åå­—è·å¾—sprite
    public Sprite ReadSpritesByString (string name)
    {
        if (name == null)
            Debug.Log("åå­—ä¸ºç©ºä¸å­˜åœ¨");
        Sprite a = null;
        foreach (KeyValuePair<string, object> pair in spritesDictionary)
        {
            // Debug.Log(pair.Key + " " + pair.Value);
            if (pair.Key.ToString() == name)
            {
              a = pair.Value as Sprite;
            }
        }
        return a;
    }
```

ç„¶åæ–°å»ºä¸€ä¸ªåŠ¨æ€æ•°æ®ç±»å’Œä¸“é—¨å­˜æ”¾List<åŠ¨æ€æ•°æ®>çš„ç±»ï¼Œæ–¹ä¾¿jsonè¯»å†™ï¼š

```csharp
public class DynamicData
{
    public int jsonId;//åŠ¨æ€æ•°æ®ID
    public int baseId;//å¯¹åº”çš„é™æ€æ•°æ®ID
    public int amount;
    public bool isSelected;
}

public class DynamicList
{
    public List<DynamicData> dyDatas=new List<DynamicData>();
}
```
 Jsonæ•°æ®è¯»å†™:

 ```csharp
using LitJson;
using System.IO;


    //å­˜å‚¨èƒŒåŒ…åŠ¨æ€æ•°æ®
    public void SaveBagData()
    {
        string json = JsonMapper.ToJson(Bagmanager.instance.dynamicList);
        
        //è·¯å¾„ä¸‹çš„æ–‡ä»¶ä¸å­˜åœ¨å°±æ–°å»ºä¸ª
        if (!File.Exists(path))
            File.Create(path ).Close();
        
        //é€‰æ‹©è¦†ç›–æ¨¡å¼ï¼Œæ¯æ¬¡å†™å…¥æ•°æ®ä¼šæ¸…é™¤ä¸Šæ¬¡æ•°æ®
        using (StreamWriter sw = new StreamWriter(new FileStream(path , FileMode.Truncate)))
        {
            sw.Write(json);
        }
    }

    //è¯»å–èƒŒåŒ…æ•°æ®
    public void ReadBagData()
    {
        //æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
        if (!File.Exists(path))
            return;

        using (StreamReader sr = new StreamReader(new FileStream(path, FileMode.Open)))
        {
            string json = sr.ReadToEnd();
            DynamicList tempList = new DynamicList();
            tempList = JsonMapper.ToObject<DynamicList>(json);
            Bagmanager.instance.dynamicList = tempList;
        }
        Bagmanager.instance.RefreshBagData();
    }

 ```

 å®Œæˆäº†èƒŒåŒ…ç‰©å“çš„åŠ¨é™æ€æ•°æ®è¯»å–å ,è¿˜è¦è®©æ•°æ®åˆ°èƒŒåŒ…çš„UIé¢æ¿ä¸Šå±•ç¤ºï¼Œè¿™é‡Œå°±å¯ä»¥æ–°å»ºä¸€ä¸ªæ¨¡æ¿é¢„åˆ¶ä½“äº†ï¼ŒåŒæ—¶è¿™é‡Œå†æ–°å»ºä¸€ä¸ªè„šæœ¬è´Ÿè´£åœ¨æ¸¸æˆå¼€å§‹æ—¶ï¼Œå°†ç›¸åº”çš„æ•°æ®å¡«å…¥åˆ°é¢„åˆ¶ä½“ï¼Œå¹¶åœ¨é¢æ¿ä¸Šç”Ÿæˆï¼Œè¿™é‡Œå°±ä¸è¯¦ç»†è¯´äº†ï¼š

 ![](4.png)

 ![](5.png)


 ---

 ç‰©å“ç³»ç»Ÿå’ŒèƒŒåŒ…æœ‰ä¸ªé›å½¢äº†ï¼Œæ¥ä¸‹æ¥çœ‹çœ‹åœŸåœ°å’‹æ•´ï¼Œé¦–å…ˆéœ€è¦å¯¹æ¯ä¸€å—åœŸåœ°å•ç‹¬è¿›è¡Œæ“ä½œï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ªè§„å¾‹çš„ç½‘æ ¼çŠ¶çš„åœŸåœ°ï¼Œè¿™é‡Œå½“ç„¶è¦ä½¿ç”¨Tilemapï¼ˆç“¦ç‰‡åœ°å›¾ï¼‰ç³»ç»Ÿã€‚

å¼€å§‹æˆ‘ä»¥ä¸ºTileç±»å°±æ˜¯ç»„æˆTilemapçš„æ¯ä¸ªå›¾å—ï¼Œä½†æŸ¥çœ‹äº†å®šä¹‰æ‰å‘ç°Tileæœ¬è´¨è¿˜æ˜¯ä¸€ä¸ªç»§æ‰¿äº†ScriptableObjectçš„ï¼Œç±»ä¼¼ unity æè´¨æˆ–çº¹ç†èµ„æºçš„æ–‡ä»¶ã€‚ï¼ˆä½¿ç”¨è¿‡Tilemapçš„æœ‹å‹çŸ¥é“ï¼Œä½¿ç”¨å‰çš„ç¬¬ä¸€æ­¥å°±æ˜¯åœ¨Tile paletteä¸­å¯¼å…¥Spriteç”ŸæˆTileæ–‡ä»¶ï¼‰æ‰€ä»¥ç›´æ¥å¯¹å•ä¸ªTileæ–‡ä»¶æ“ä½œï¼Œè¿›è€Œæ”¹å˜æ¸¸æˆä¸­çš„å›¾å—æ˜¯ä¸å¯å–çš„ï¼Œæœ¬æœ«å€’ç½®äº†ã€‚

å¥½åœ¨Unityè¿˜æ˜¯å¾ˆè´´å¿ƒçš„æä¾›äº†æ–¹æ³•æ¥å¯¹æ¯ä¸ªå•å…ƒæ ¼è¿›è¡Œæ“ä½œï¼Œä½ å¯ä»¥è·å–Tilemapçš„æ¯ä¸ªå›¾å—çš„åæ ‡ï¼Œç„¶åè¿›è¡ŒTileçš„æ›´æ¢ï¼š

![](7.png)

æ¥ä¸‹æ¥å¼€å§‹å®ç°åœŸåœ°ï¼Œè¿™é‡Œæˆ‘åˆ›å»ºäº†ä¸¤å±‚Tilemapï¼Œç¬¬ä¸€å±‚å±•ç¤ºåœŸåœ°çŠ¶æ€ï¼ˆæ¯”å¦‚æµ‡æ°´åœŸåœ°ä¼šæ¹¿ä¸€å—ï¼‰ï¼Œç¬¬äºŒå±‚å±•ç¤ºç‰©å“ï¼Œæ¯æ¬¡ä½¿ç”¨å¯¹åº”çš„Tileéƒ½è¦æ‰‹åŠ¨å°†spriteæ‹–åˆ°Tile paletteä¸­ç”Ÿæˆè¿˜æ˜¯æŒºéº»çƒ¦çš„ï¼Œè¿™é‡ŒåŒæ ·å†™äº†ä¸ªæ ¹æ®Spriteåç”ŸæˆTile çš„æ–¹æ³•ï¼š

![](8.png)

```csharp
  //åˆ¤å®šåœ¨Tilemapæ–‡ä»¶å¤¹ä¸‹å¦å­˜åœ¨è¯¥åç§°çš„tileæ–‡ä»¶ï¼Œä¸å­˜åœ¨å°±åˆ›å»ºæ–°çš„å¹¶ä¿å­˜ä¸‹æ¥

    public Tile CheckTileExits(string name)
    {
        string tempPath = string.Format("{0}{1}", "Tilemap/", name);
        string Path = string.Format("{0}{1}{2}", "/Resources/Tilemap/", name, ".asset");
        string Lastpath = Application.dataPath + Path;
        if (!File.Exists(Lastpath))
        {
            CreateExampleAsset(name);
            Tile land1 = (Tile)Resources.Load(tempPath);
            return land1;
        }
        Tile land2 = (Tile)Resources.Load(tempPath);
        return land2;
    }

    // æ ¹æ®ç²¾çµå›¾åå­—åˆ›å»ºtile
    public void CreateExampleAsset(string name)
    {
        string Path = "Assets/Resources/Tilemap/";
        Tile exampleAsset = Tile.CreateInstance<Tile>();
        exampleAsset.sprite = Bagmanager.instance.ReadSpritesByString(name);
        string temp = string.Format("{0}{1}{2}", Path, name, ".asset");
        AssetDatabase.CreateAsset(exampleAsset, temp);
        AssetDatabase.Refresh();
    }
```
ç„¶åæ–°å»ºä¸€ä¸ªåœŸåœ°ç±»ï¼š

```csharp
public enum LandType
{
    Unkown, normal, reclaimed, seeded, watered, planted
}

public class Land
{
    public int Id;
   
    //å½“å‰åœŸåœ°çŠ¶æ€
    public LandType landType;

    //æ¯ä¸€å—åœŸåœ°çš„åæ ‡ï¼ˆå¯¹åº”Tilemapä¸­çš„å›¾å—åæ ‡ï¼‰
    public Vector3Int LandPos;

    //éœ€è¦å±•ç¤ºçš„å›¾ç‰‡é›†åˆ
    public string [] icons ;

    //ç§å­æ‰€éœ€çš„æˆé•¿æ—¶é—´
    public int growTime;

    //ç§å­ä¸€å¼€å§‹ç§ä¸‹çš„æ—¶é—´
    public int startTime;

    //ç§å­å®é™…æˆé•¿æ—¶é—´
    public float actualTime;
}
```

åœŸåœ°æ•°æ®çš„è¯»å†™æ“ä½œå’Œç‰©å“çš„å·®ä¸å¤šï¼Œè¿™é‡Œä¹Ÿä¸è¿‡å¤šèµ˜è¿°ï¼Œæ¥ä¸‹æ¥è§£å†³æ“ä½œé—®é¢˜ï¼Œè¿™é‡Œå…ˆä¸ç®¡åŠ¨ç”»ï¼Œè§£å†³ä¸»è¦é—®é¢˜ï¼ˆå…¶å®å°±æ˜¯æ‡’ï¼‰ï¼Œæ˜Ÿéœ²è°·ä¸­å…è®¸å¯¹äººç‰©å‘¨å›´çš„8ä¸ªå›¾å—è¿›è¡Œå„ç§æ“ä½œï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦äººç‰©è‡ªèº«çš„åæ ‡ï¼ŒåœŸåœ°å·²ç»ç½‘æ ¼åŒ–äº†ï¼Œæ‰€ä»¥äººç‰©è‡ªèº«çš„åæ ‡ä¹Ÿéœ€è¦è½¬æ¢åœŸåœ°å¯¹åº”çš„åæ ‡ï¼ˆè¿™é‡Œè¦ä»¥äººç‰©çš„è„šä¸ºä¸­å¿ƒç‚¹ï¼‰ï¼š

```csharp

 public Vector3Int[] GetHumanAround()
    {
        Vector3Int temp = GetCurPos();
        Vector3Int[] temps = new Vector3Int[8];
        temps[0] = new Vector3Int(temp.x-1, temp.y+1,0);
        temps[1] = new Vector3Int(temp.x, temp.y+1,0);
        temps[2] = new Vector3Int(temp.x+1, temp.y+1,0);
        temps[3] = new Vector3Int(temp.x-1, temp.y,0);
        
        temps[4] = new Vector3Int(temp.x+1, temp.y,0);
        temps[5] = new Vector3Int(temp.x-1, temp.y-1,0);
        temps[6] = new Vector3Int(temp.x, temp.y-1,0);
        temps[7] = new Vector3Int(temp.x + 1, temp.y - 1, 0);
        return temps;
       
    }
```
åŒæ—¶é¼ æ ‡åæ ‡ä¹Ÿè½¬æ¢ä¸ºIntå‹ï¼Œåœ¨æŒ‡å®šå›¾å—è¿›è¡Œæ“ä½œï¼Œæ»¡è¶³æ¡ä»¶å³å¯æ‰§è¡Œ.

æœ€åå€¼å¾—ä¸€æçš„æ˜¯æ—¶é—´å’Œæ¯ä¸ªå›¾å—è¢«äººç‰©ç¢°åˆ°çš„å°åŠ¨ç”»ï¼Œè¿™ä¸¤ä¸ªéƒ¨åˆ†æˆ‘éƒ½ç”¨åç¨‹å®Œæˆï¼Œè™½ç„¶ç”¨åç¨‹è®°å½•æ—¶é—´ä¼šæœ‰è¯¯å·®ï¼Œä½†æ˜Ÿéœ²è°·å¹¶ä¸æ˜¯å¯¹æ—¶é—´è¦æ±‚å¾ˆç²¾ç¡®çš„æ¸¸æˆï¼š

æ—¶é—´ï¼š

```csharp

// 10sè®°å½•ä¸€æ¬¡æ—¶é—´ï¼Œä¹Ÿé¡ºä¾¿åˆ·æ–°å³ä¸Šè§’çš„æ—¶é—´é¢æ¿ï¼ˆ10sç›¸å½“äºæ˜Ÿéœ²è°·çš„10åˆ†é’Ÿï¼‰
  public IEnumerator TimeIncrease()
    {
        while (true)
        {
            while (gameTime.time <= 1200)
            {
                gameTime.time += 10f;
                rotate.z = rotate.z + 0.15f;

                yield return new WaitForSeconds(10f);
                RotatePoint.Rotate(rotate);
                dayText.text = string.Format("{0}{1}", gameTime.day.ToString(), "æ—¥");
                hour = (int)(gameTime.time / 60);
                minute = (int)(gameTime.time - hour * 60);
                string tempTime = string.Format("{0}{1}{2}", hour.ToString(), ":", minute.ToString());
                minuteText.text = tempTime;
             }
            DayEnd();
        }
 }

```

æ¯ä¸ªå›¾å—çš„åŠ¨ç”»è¿™é‡Œæœ‰ç‚¹éº»çƒ¦ï¼ŒUnityå°†æ¯ä¸ªå›¾å—çš„transformæ•°æ®å°è£…åˆ°äº†ä¸€ä¸ª4x4çš„çŸ©é˜µä¸­å—ï¼Œæ‰€ä»¥éœ€è¦é¢å¤–åšä¸€æ¬¡çŸ©é˜µè½¬æ¢ï¼Œå†è°ƒç”¨è¿™ä¸ªæ–¹æ³•å®Œæˆè¿™ä¸ªå°åŠ¨ç”»ï¼š

![](9.png)

```csharp
    //åˆ¤æ–­æ˜¯å¦ç¢°åˆ°äº†ç§å­
    public void TouchCrop()
    {
        Vector3Int tempPos1 = GetCurPos();
        Matrix4x4 curTrans=new Matrix4x4();
        foreach (var key in LandManager.instance.seededPos.Keys)
        {
            if (LandManager.instance.seededPos[key] == tempPos1)
            {
                curTrans = LandPanel.level2.GetTransformMatrix(LandManager.instance.lands.land2[key].LandPos);
               if (direction == Direction.Left || direction == Direction.DownLeft || direction == Direction.UpLeft)
                {
                   StartCoroutine(LeftShake(0.5f, curTrans, key));
                }
                else
                {
                   StartCoroutine(RightShake(0.5f, curTrans, key));
                }
                break;
            }
        }
    }

    // åº„ç¨¼å·¦æŠ–åŠ¨
    public IEnumerator  LeftShake(float duration,Matrix4x4 curTrans,int key)
    {
        Vector3 temp = new Vector3(0, 0, 0);
        float elapsed = 0f;

        while (elapsed < duration)
            {
                if (elapsed < duration / 2)
                {
                    temp = temp + (leftAngel / duration) * Time.deltaTime * 2;
                    Quaternion temp_rotation = Quaternion.Euler(temp);
                    curTrans.SetTRS(curTrans.GetPostion(), temp_rotation, new Vector3(1, 1, 1));
                    LandPanel.level2.SetTransformMatrix(LandManager.instance.lands.land2[key].LandPos, curTrans);
                }
                else if(elapsed < duration)
                {
                    temp= temp- (leftAngel / duration) * Time.deltaTime * 2;
                    Quaternion temp_rotation = Quaternion.Euler(temp);
                    curTrans.SetTRS(curTrans.GetPostion(), temp_rotation, new Vector3(1, 1, 1));
                    LandPanel.level2.SetTransformMatrix(LandManager.instance.lands.land2[key].LandPos, curTrans);
                }
            elapsed += Time.deltaTime;
            yield return 0;
        }
    }
```

æœ€åå±•ç¤ºä¸‹ç›®å‰çš„æ–½å·¥è¿›åº¦ï¼Œæ˜Ÿéœ²è°·è¿˜æœªå®Œç»“ï¼Œæš‚æ—¶å…ˆä¸æ”¾è¿™ä¸ªè¿˜æœªåœ†æ»¡çš„å·¥ç¨‹äº†:


![](10g.gif)

æœ€åæ„Ÿè°¢çŸ¥ä¹ @çµ®é…±é…± çš„EPPlusçš„å°æ•™ç¨‹ï¼Œæ°¸è¿œæ»´ç¥ï¼šé©¬ä¸‰å°ä¼™å„¿å†™çš„Litjsonæ‰©å±•ï¼ˆLitjsonåŸç‰ˆä¸æ”¯æŒVector3Intç±»å‹æ•°æ®ï¼‰å’Œ_é˜¿æ¾å…ˆç”Ÿçš„çŸ©é˜µè½¬æ¢å·¥å…·ç±»ï¼Œæ„Ÿè°¢å¤§ä½¬ä»¬çš„å·¥ä½œï¼Œè®©ä¿ºèŠ‚çœäº†å¾ˆå¤šçš„åŠŸå¤«~
è´´ä¸Šé©¬ä¸‰å°ä¼™å„¿å’Œé˜¿æ¾å…ˆç”Ÿçš„åŸå¸–åœ°å€ï¼š

[é­”æ”¹Json](https://cloud.tencent.com/developer/article/1608178)

[Matrix4x4çŸ©é˜µå˜æ¢è¯¦ç»†å®ä¾‹](https://blog.csdn.net/aaa583004321/article/details/81948780?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-1.channel_param&depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-1.channel_param)